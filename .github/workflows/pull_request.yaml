name: Tutorial Pull Request
on: [pull_request]

jobs:
  test_protos:
    # ref: https://github.com/actions/virtual-environments/issues/2
    runs-on: ubuntu-16.04
    steps:
      - uses: actions/checkout@v1
      - name: Lint protos
        uses: ./.github/actions/prototool
        with:
          # `root` will get translated into `INPUT_ROOT` env var
          root: protos
          args: lint
      - name: Compile protos
        uses: ./.github/actions/prototool
        with:
          # `root` will get translated into `INPUT_ROOT` env var
          root: protos
          args: compile
  generate_protos:
    runs-on: ubuntu-16.04
    needs: [test_protos]
    steps:
      - uses: actions/checkout@v1
      - uses: ./.github/actions/prototool
        with:
          # `root` will get translated into `INPUT_ROOT` env var
          root: protos
          args: generate
      - run: sudo chmod -R 777 protos/gen
      - uses: actions/upload-artifact@v1
        with:
          name: protos
          path: protos/gen
